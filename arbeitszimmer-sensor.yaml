substitutions:
  room: arbeitszimmer
  uroom: Arbeitszimmer


esphome:
  name: $room-sensor
  platformio_options: 
    board_build.extra_flags:
      - "-DARDUINO_USB_CDC_ON_BOOT=0"
  on_boot:
    - priority: 600
      then:
      - light.turn_on:
          id: led
          brightness: 100%
          red: 100%
          green: 0
          blue: 0
      - wait_until:
          wifi.connected:
      - light.turn_on:
          id: led
          brightness: 100%
          red: 100%
          green: 100%
          blue: 0
      - wait_until:
          api.connected:
      - light.turn_on:
          id: led
          brightness: 100%
          red: 0%
          green: 100%
          blue: 0
      - delay: 1s
      - light.turn_off: led

 
esp32:
  board: lolin_c3_mini
  framework:
    type: arduino

# Enable Home Assistant API
api:
  encryption:
    key: "RhqBxxEgN+A2oPYWWv7vZAvjHgMINwam9YZePtojI0s="

ota:
  password: "f3269d23a656daab91ce786e042593ab"

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  output_power: 10

mqtt:
  broker: mqtt.ch5.garf.de
  discovery: false
  discovery_retain: false
  topic_prefix: /Chattenweg5/$uroom/sensor
  reboot_timeout: 0s
  keepalive: 20s
  username: $room-sensor
  password: $room-sensor

# Enable logging
logger:

debug: 
  update_interval: 120s

light:
  - platform: neopixelbus
    pin: GPIO7
    variant: ws2811
    num_leds: 1
    name: LED
    type: RGB
    id: led
 

i2c:
  - id: bus_a
    scan: True
    sda: GPIO8
    scl: GPIO10

uart:
  rx_pin: GPIO4
  tx_pin: GPIO5
  baud_rate: 9600
  id: uartdust

text_sensor:
  - platform: debug
    device:
      name: "Device Info"
    reset_reason:
      name: "Reset Reason"

button:
  - platform: safe_mode
    name: "Restart (Safe Mode)"
  - platform: restart
    name: "Restart"

sensor:
  - platform: sds011
    uart_id: uartdust
    pm_2_5:
      id: "${room}_p25"
      name: "${uroom} Feinstaub <2.5µm"
    pm_10_0:
      id: "${room}_p10"
      name: "${uroom} Feinstaub <10.0µm"
    update_interval: 3min
  - platform: debug
    free:
      name: "Heap Free"
    block:
      name: "Heap Max Block"
    loop_time:
      name: "Loop Time"
  - platform: wifi_signal
    name: "WiFi Signal"
    update_interval: 60s
  - platform: bme680
    address: 0x77
    temperature:
      accuracy_decimals: 2
      name: "${uroom} Temperatur"
      id: ${room}_temperature
      on_value:
        then:
          - mqtt.publish:
              topic: "/Chattenweg5/$uroom/temperature"
              payload: !lambda |-
                return to_string(id(${room}_temperature).state);
    pressure:
      accuracy_decimals: 2
      name: "${uroom} Luftdruck"
      id: "${room}_pressure"
    humidity:
      accuracy_decimals: 2
      name: "${uroom} Luftfeuchtigkeit"
      id: "${room}_humidity"
      on_value:
        then:
          - mqtt.publish:
              topic: "/Chattenweg5/$uroom/humidity"
              payload: !lambda |-
                return to_string(id(${room}_humidity).state);
    gas_resistance:
      accuracy_decimals: 2
      name: "${uroom} Gas Resistance"
  - platform: max44009
    name: "${uroom} Helligkeit"
    id: "${room}_light"
    accuracy_decimals: 2
    update_interval: 60s
  - platform: absolute_humidity
    name: "${uroom} Absolute Luftfeuchtigkeit"
    temperature: ${room}_temperature
    humidity: ${room}_humidity